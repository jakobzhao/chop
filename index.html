<!DOCTYPE html>
<html>
   <head>
      <title>Tile Generations</title>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <link href="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.css" rel="stylesheet">
      <link rel="stylesheet" href="css/style.css">
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
      <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
      <script src="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.js"></script>
   </head>
   <script>
      $(document).ready(function(){
      	$("#myModal").modal('show');
      });
   </script>
   </head>
   <body>
      <div id="myModal" class="modal fade">
         <div class="modal-dialog">
            <div class="modal-content">
               <div class="modal-header">
                  <h5 class="modal-title">Disclaimer</h5>
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
               </div>
               <div class="modal-body">
                  <p>This is the disclaimer section</p>
               </div>
            </div>
         </div>
      </div>
   </body>

   <main>
    <div id="info" class="d-flex flex-column">
        <h4>Seattle</h4>
        <p id="test">Left to write
        </p>
    </div>
   </main>

   <body>
      <nav id="menu"></nav>
      <div id='map'></div>
      <button id="fit">Click to View CHOP Zone</button>
      <script type="text/javascript">
         mapboxgl.accessToken =
             'pk.eyJ1IjoiamFrb2J6aGFvIiwiYSI6ImNpcms2YWsyMzAwMmtmbG5icTFxZ3ZkdncifQ.P9MBej1xacybKcDN_jehvw';
         let map = new mapboxgl.Map({
             container: 'map', // container ID
             style: 'mapbox://styles/mapbox/satellite-streets-v11',
             zoom: 16, // starting zoom
             pitch: 60,
             bearing: -90, // bearing in degrees
             center: [-122.319212, 47.616815]// starting center
         });
         
         document.getElementById('fit').addEventListener('click', () => {
            map.fitBounds([
            [-122.314239, 47.614112], // southwestern corner of the bounds
            [-122.322178, 47.618772] // northeastern corner of the bounds
            ], {bearing: -90});
        });

        map.on('load', () => {
            map.addSource('speech-area', {
            'type': 'geojson',
            /*
            * Each feature in this GeoJSON file contains values for
            * `properties.height`, `properties.base_height`,
            * and `properties.color`.
            * In `addLayer` you will use expressions to set the new
            * layer's paint properties based on these values.
            */
            'data': 'assets/map.geojson'
            });

            map.addLayer({
                'id': 'room-extrusion',
                'type': 'fill-extrusion',
                'source': 'speech-area',
                'paint': {
                // Get the `fill-extrusion-color` from the source `color` property.
                'fill-extrusion-color': ['get', 'color'],
                 
                // Get `fill-extrusion-height` from the source `height` property.
                'fill-extrusion-height': ['get', 'height'],
                 
                // Get `fill-extrusion-base` from the source `base_height` property.
                'fill-extrusion-base': ['get', 'base_height'],
                 
                // Make extrusions slightly opaque to see through indoor walls.
                'fill-extrusion-opacity': 0.5
                }
                });
                });

        
         map.on('load', () => {
         // Insert the layer beneath any symbol layer.
         const layers = map.getStyle().layers;
         const labelLayerId = layers.find(
         (layer) => layer.type === 'symbol' && layer.layout['text-field']
         ).id;
         
         // The 'building' layer in the Mapbox Streets
         // vector tileset contains building height data
         // from OpenStreetMap.
         map.addLayer(
         {
         'id': 'add-3d-buildings',
         'source': 'composite',
         'source-layer': 'building',
         'filter': ['==', 'extrude', 'true'],
         'type': 'fill-extrusion',
         'minzoom': 15,
         'paint': {
         'fill-extrusion-color': '#aaa',
         
         // Use an 'interpolate' expression to
         // add a smooth transition effect to
         // the buildings as the user zooms in.
            'fill-extrusion-height': [
                'interpolate',
                ['linear'],
                ['zoom'],
                15,
                0,
                15.05,
                ['get', 'height']
            ],
            'fill-extrusion-base': [
                'interpolate',
                ['linear'],
                ['zoom'],
                15,
                0,
                15.05,
                ['get', 'min_height']
            ],
            'fill-extrusion-opacity': 0.9
            }
            },
            labelLayerId
             );
            });

         
         map.on('load', () => { //simplifying the function statement: arrow with brackets to define a function
         
             map.addSource('chop-polygon', {
                 'type': 'geojson',
                 'data': {
                     'type': 'Feature',
                     'geometry': {
                     'type': 'Polygon',
                     // These coordinates outline Maine.
                     "coordinates": [
                     [
                       [-122.32006072998045, 47.61887821523188],
                       [-122.32003927230835, 47.61760539080741],
                       [-122.32087612152098, 47.617634318979356],
                       [-122.32085466384888, 47.6164193219776],
                       [-122.32003927230835, 47.61643378639368],
                       [-122.32006072998045, 47.61549359102625],
                       [-122.32089757919312, 47.615435732297605],
                       [-122.32087612152098, 47.614076033744695],
                       [-122.3156189918518, 47.61411942892555],
                       [-122.3156189918518, 47.616535037194176],
                       [-122.31679916381835, 47.61650610841403],
                       [-122.31679916381835, 47.61818395120519],
                       [-122.31780767440794, 47.61815502333736],
                       [-122.31782913208008, 47.61887821523188],
                       [-122.32006072998045, 47.61887821523188]
                       ]
                     ]
                 }
             }
         });
             map.addLayer({
                 'id': 'CHOP Zone',
                 'type': 'fill',
                 'source': 'chop-polygon',
                 'layout': {
                    'visibility': 'none'
                    },
                 'paint': {
                     'fill-color': '#0080ff', // blue color fill
                     'fill-opacity': 0.5,
                     }
                 },
                    'waterway-label'
                 );

            map.addLayer({
                'id': 'outline',
                'type': 'line',
                'source': 'chop-polygon',
                'layout': {},
                'paint': {
                'line-color': '#000',
                'line-width': 3
                    }
                },
                    'waterway-label'
                );
         
             map.addSource('drone-tile', {
                 'type': 'raster',
                 'tiles': [
                     'assets/drone_img/{z}/{x}/{y}.png'
                 ],
                 'tileSize': 256,
                 'attribution': 'Map tiles designed by Huating Sun'
             });
         
             map.addSource('graffiti-tile', {
                 'type': 'raster',
                 'tiles': [
                     'assets/graffiti/{z}/{x}/{y}.png'
                 ],
                 'tileSize': 256,
                 'attribution': 'Map tiles designed by Huating Sun'
             });
         
             map.addLayer({
                 'id': 'Drone Image',
                 'type': 'raster',
                 'layout': {
                     'visibility': 'none'
                 },
                 'source': 'drone-tile',
             },
                'waterway-label'
             );
         
             map.addLayer({
                 'id': 'Graffiti',
                 'type': 'raster',
                 'layout': {
                     'visibility': 'none'
                 },
                 'source': 'graffiti-tile'
             });         
         });
         
         
         // After the last frame rendered before the map enters an "idle" state.
         map.on('idle', () => {
             // If these two layers were not added to the map, abort
             if (!map.getLayer('Drone Image', 'Graffiti', 'CHOP Zone')) {
                 return;
             }
         
             // Enumerate ids of the layers.
             const toggleableLayerIds = ['Drone Image', 'Graffiti', 'CHOP Zone'];
         
             // Set up the corresponding toggle button for each layer.
             for (const id of toggleableLayerIds) {
                 // Skip layers that already have a button set up.
                 if (document.getElementById(id)) {
                     continue;
                 }
         
                 // Create a link.
                 const link = document.createElement('a');
                 link.id = id;
                 link.href = '#';
                 link.textContent = id;
                 link.className = 'inactive';
         
                 // Show or hide layer when the toggle is clicked.
                 link.onclick = function (e) {
                     const clickedLayer = this.textContent;
                     // preventDefault() tells the user agent that if the event does not get explicitly handled, 
                     // its default action should not be taken as it normally would be.
                     e.preventDefault();
                     // The stopPropagation() method prevents further propagation of the current event in the capturing 
                     // and bubbling phases. It does not, however, prevent any default behaviors from occurring; 
                     // for instance, clicks on links are still processed. If you want to stop those behaviors, 
                     // see the preventDefault() method.
                     e.stopPropagation();
         
                     const visibility = map.getLayoutProperty(
                         clickedLayer,
                         'visibility'
                     );
         
                     // Toggle layer visibility by changing the layout object's visibility property.
                     // if it is currently visible, after the clicking, it will be turned off.
                     if (visibility === 'visible') {
                         map.setLayoutProperty(clickedLayer, 'visibility', 'none');
                         this.className = '';
                     } else { //otherise, it will be turned on.
                         this.className = 'active';
                         map.setLayoutProperty(
                             clickedLayer,
                             'visibility',
                             'visible'
                         );
                     }
                 };
         
                 // in the menu place holder, insert the layer links.
                 const layers = document.getElementById('menu');
                 layers.appendChild(link);
             }
         });

         // const drone_img = document.getElementById('Drone Image')
         // map.on('zoom', () => {
            // if (map.getZoom() > 16) {
                //map.setLayoutProperty('Drone Image', 'visibility', 'visible');
            //} else {
                //map.setLayoutProperty('Drone Image', 'visibility', 'none');
            //}
            //});
      </script>
   </body>
</html>